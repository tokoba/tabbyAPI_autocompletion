それでは機能改良を行いたいので，まず現在のコードベースの内容に基づいて，以下の機能改良を行うにはどのような順序で編集・改良すればよいかを調査し，リファクタリング計画書を作成してください。作業はWBS単位に分割して進捗を確認できるようなテーブル形式もあると良いです。これを upgrade/add_inference_cancelling.md というファイル名で保存してください。機能改良の内容は， exllamav3 のバックエンドおよびエンドポイントの機能改良を目的としています。具体的には， `v1/completions` のエンドポイントに相当する @endpoints/OAI/utils/completion.py 内の `generate_completion` 関数およびこの関数から参照されているバックエンドの関数を改良し，一度発行した要求をキャンセルできる機能を追加することです。具体的なユースケースを説明します。この tabbyapi, exllamav3 エンジンは vs code エディターのcontinue.dev の提供するtab autocompletion 拡張機能からアクセスされています。このエディターの拡張機能はユーザーが文字入力すると，その文字の前後のコンテキストを`editorにユーザーが入力 -> continue.dev -> tabbyapi -> exllamav3 -> inference -> exllamav3 -> tabbyapi -> continue.dev ->  エディターの画面にLLMが推論した補完候補を表示`するという機能を提供しています。このとき現行の設計で問題になっているのが，タブ補完機能の場合はユーザーが文字を入力するたびにイベントが発生し，次々とバックエンドに対してプロンプト(補完要求の fim fill in the middle要求)が投げられます。実際にはユーザーはすべての補完要求に対する応答は必要ありません。なぜかというとユーザーが新たな文字を入力するたびに，コンテキスト自体が変化しており，過去にリクエストされた補完要求は意味を失うからです。そのため，最後に要求された最新の1回分以外の要求は自動的にキャンセルする機能がほしいです。そして，最後の要求だけは正常にユーザーに対して応答を返すようにしてください。この機能が動作していることをデバッグログで確認できるようにロガー機能を有効化して，「現在キューイングされているリクエスト数」を表示するようにしてください。現行のリファクタリング前ではユーザーが文字入力するたびにイベントが発行されるので，おそらくキューイングされているリクエスト数が数十個になっていると思います。それが，リファクタリングに成功した場合はキューイングされたリクエスト数は最大でも1個にとどまるはずです。最新の要求以外はキャンセルされるからです。ただし，バックエンドの設計次第ではキャンセルされるまでにタイムラグが生じることがあるかもしれません。その場合に，フロントエンドであるtabyyapiとバックエンドであるexllamav3のどちらに問題があるのかを切り分けられるようにもしておきたいです。以上の要求を詳細に理解した上で，コードベースを調査し，この要求を満足するためにはどのような機能改良が必要化をブレークダウンして設計変更の計画書にしてください。
